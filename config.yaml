# NRHOF Matrix Kiosk Configuration

# Development overrides (activated when NRHOF_DEV=1)
dev_overrides:
  window:
    fullscreen: false
    width: 1280
    height: 720
  flow:
    auto_cycle: true       # splash -> intro -> menu
  audio:
    muted: true
  mic_listener:
    enabled: true          # Enable debug mic listener worker

# Render settings
render:
  backend: "pygame"          # pygame (current) | swift (future Metal renderer)
  resolution: [1280, 1024]
  fullscreen: false           # Run in fullscreen kiosk mode
  display: 0                 # 0=primary display, 1=secondary display
  fps_target: 60
  # Note: Colors, fonts, and visual styling now in styles/pipboy.yaml

# Audio settings
audio:
  sample_rate: 44100
  frame_size: 2048
  music_threshold: 0.01      # RMS threshold for music detection
  music_debounce: 0.5        # Seconds before state change
  poll_interval: 0.1         # Audio monitoring interval (100ms)

# Mic listener (debug worker for monitoring mic input)
mic_listener:
  enabled: false             # Enable mic listener worker
  frame_duration_ms: 10      # Frame duration in ms (10ms = 160 samples at 16kHz)
  update_interval_ms: 100    # How often to update audio level
  log_interval_s: 5          # How often to log frame stats

# Recognition settings (placeholder for future)
recognizer:
  enabled: false
  cooldown: 5.0              # Seconds between recognition attempts
  confidence_threshold: 0.7   # Minimum confidence to accept result
  same_track_window: 30.0    # Seconds to suppress duplicate recognition

# Integrations
integrations:
  webflow:
    enabled: true
    sync_window: 300.0       # Don't sync same track within 5 minutes
    retry_backoff_max: 300   # Max backoff in seconds

# Localization
localization:
  language: "en"  # en (English) | jp (Japanese)

# Wake word detection (Picovoice Porcupine)
# API key loaded from PICOVOICE_ACCESS_KEY environment variable
wake_word:
  enabled: true  # Set to true when you have Picovoice access key in .env
  picovoice_access_key: "${PICOVOICE_ACCESS_KEY}"  # Loaded from .env
  keywords: ["picovoice"]  # Built-in keywords: jarvis, alexa, computer, etc.
  keyword_paths: []  # Custom .ppn files (e.g., "assets/wake_words/hey-nerd.ppn")
  sensitivity: 0.75  # 0.0 (least sensitive) to 1.0 (most sensitive)

# Voice Activity Detection (WebRTC VAD)
vad:
  enabled: true
  sample_rate: 16000
  frame_duration_ms: 10  # Must be 10, 20, or 30
  aggressiveness: 2  # 0-3, higher = more aggressive
  tail_ms: 700  # Silence duration before declaring speech end

# Voice control and streaming audio (reserved for future implementation)
voice:
  # Speech-to-text provider (future: whisper, deepgram, etc.)
  stt_provider: null
  stt_model: null

  # Text-to-speech provider (future: elevenlabs, openai, etc.)
  tts_provider: null
  tts_voice: null

  # Audio ducking (reduce background volume during voice interaction)
  ducking:
    enabled: false
    gain_db: -12.0  # Volume reduction in dB
    fade_duration_ms: 300  # Fade in/out duration

  # Acoustic echo cancellation (future)
  aec:
    enabled: false
    filter_length: 512  # AEC filter length in samples

  # Voice activity detection
  vad:
    enabled: false
    threshold: 0.5  # Voice activity threshold

# Spotify Integration (Primary music source)
spotify:
  enabled: true
  client_id: "${SPOTIFY_CLIENT_ID}"
  client_secret: "${SPOTIFY_CLIENT_SECRET}"
  redirect_uri: "http://127.0.0.1:8888/callback"
  cache_path: ".spotify_cache"  # OAuth token cache (gitignored)
  poll_interval_seconds: 2.0  # How often to check for track changes

# Sonos Integration (Secondary music source - local network)
sonos:
  enabled: true
  poll_interval_seconds: 2.0  # How often to check for track changes
  target_room: null  # null = dynamically follow any playing speaker, or set specific room speaker, or set specific room name room name (e.g., "Living Room"), null = auto-discover

# Source Manager (Music source arbitration)
source_manager:
  min_change_interval_seconds: 2.0  # Debounce track changes
  confidence_threshold: 0.6  # Minimum confidence for vinyl matches
  hysteresis_seconds: 5.0  # Stick to current source for this long

# Song Recognition (ACRCloud) - Only for vinyl/line-in mode
song_recognition:
  enabled: false  # Disabled - will use Spotify as primary source
  acrcloud:
    access_key: "${ACRCLOUD_ACCESS_KEY}"
    access_secret: "${ACRCLOUD_ACCESS_SECRET}"
    host: "${ACRCLOUD_HOST}"
  min_interval_seconds: 10
  audio_buffer_seconds: 8

# Feature flags
flags:
  use_prebaked_video: false
  use_live_math: true
  enable_recognition: false
  enable_webflow: false
  enable_voice: true
  offline_mode: false
  skip_intro: false  # Skip intro typewriter scene (for development)

# Note: Scene content (splash, intro, menu) now in content/ directory
# Note: Scene layouts now in layouts/ directory
# Note: Theme colors and fonts now in styles/ directory

# Visualizer settings
visualizers:
  spectrum_bars:
    bars: 32
    decay: 0.95

  waveform:
    num_waves: 3
    points: 100
    speed: 2.0
    freq_bands: [[20, 250], [250, 2000], [2000, 20000]]

  lissajous:
    a: 3
    b: 4
    delta: 1.5708
    trail: 50

# Logging
logging:
  level: "DEBUG"              # DEBUG, INFO, WARNING, ERROR
  file: "runtime/kiosk.log"
  max_size_mb: 10
  backup_count: 3
  structured: true           # JSON lines format
